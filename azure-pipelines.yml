trigger:
  branches:
    include:
      - main  # O la rama que uses

pool:
  vmImage: 'ubuntu-latest'

variables:
  dockerImageName: 'my-ci-image'
  dockerTag: 'ci-$(Build.BuildId)'

steps:
  - task: DockerInstaller@0
    displayName: '🔧 Instalar Docker'

  - task: Docker@2
    displayName: '🐳 Build imagen Docker (solo CI)'
    inputs:
      command: 'build'
      repository: '$(dockerImageName)'
      dockerfile: '**/Dockerfile'
      tags: |
        $(dockerTag)

  - script: |
      docker run --rm $(dockerImageName):$(dockerTag) npm test
    displayName: '🧪 Ejecutar pruebas dentro del contenedor'
